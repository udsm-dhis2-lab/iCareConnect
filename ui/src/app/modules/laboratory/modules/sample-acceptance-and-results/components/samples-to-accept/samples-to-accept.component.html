<div
  *ngIf="{
    samplesLoadedState: samplesLoadedState$ | async,
    samplesGroupedBymRNo: samplesWaitingAcceptanceGroupedByMrNo$ | async,
    samplesToFeedResults: samplesWaitingToFeedResults$ | async,
    technicianWorklist: technicianWorklist$ | async,
    samplesFullCompleted: samplesFullCompleted$ | async,
    completedResultsGroupedByMRN: completedResultsGroupedByMRN$ | async,
    providerDetails: providerDetails$ | async,
    labSamplesWaitingToFeedResults: labSamplesWaitingToFeedResults$ | async,
    labSamplesForTrackingDetails: labSamplesForTrackingDetails$ | async,
    settingLabSampleStatus: settingLabSampleStatus$ | async
  } as params"
>
  <mat-card>
    <div *ngIf="params?.samplesLoadedState && params?.samplesGroupedBymRNo">
      <mat-tab-group (selectedTabChange)="onOpenNewTab($event)">
        <mat-tab label="Sample acceptance">
          <div style="padding: 15px 2px">
            <div>
              <mat-form-field class="w-50">
                <mat-label>Search</mat-label>
                <mat-icon matPrefix>search</mat-icon
                ><input
                  matInput
                  (keyup)="onSearch($event)"
                  [(ngModel)]="searchingText"
                />
              </mat-form-field>

              <mat-form-field appearance="fill" class="w-30 ml-2 float-right">
                <mat-label>Select Department</mat-label>
                <mat-select [(value)]="selectedDepartment">
                  <mat-option (click)="setDepartment('')"
                    >All Departments</mat-option
                  >
                  <mat-option
                    *ngFor="let dept of labDepartments"
                    [value]="dept.display"
                    (click)="setDepartment(dept.display)"
                  >
                    {{ dept.display }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <table class="table table-bordered table-striped">
              <thead class="table-header">
                <tr>
                  <th rowspan="2">SN</th>
                  <th rowspan="2">MRNo.</th>
                  <th rowspan="2">Patient Names</th>
                  <th rowspan="2">Department</th>
                  <th rowspan="2">Sample ID</th>
                  <th rowspan="2">Container</th>
                  <th rowspan="2">Sample/Specimen</th>
                  <th colspan="3" style="text-align: center">Test Details</th>
                  <th rowspan="2">Priority</th>
                  <th rowspan="2">Collected By</th>
                  <th rowspan="2">Actions</th>
                </tr>
                <tr>
                  <th>Test</th>
                  <th>Ordered By</th>
                  <th>Order Date</th>
                </tr>
              </thead>
              <tbody>
                <ng-container
                  *ngIf="
                    params?.samplesGroupedBymRNo &&
                    params?.samplesGroupedBymRNo?.length > 0
                  "
                >
                  <!-- 
                {{params?.samplesGroupedBymRNo | json}} -->
                  <ng-container
                    *ngFor="
                      let sampleGroupedBymRNo of params?.samplesGroupedBymRNo;
                      let count = index
                    "
                  >
                    <ng-container
                      *ngFor="
                        let sample of sampleGroupedBymRNo?.samples;
                        let i = index
                      "
                    >
                      <tr
                        *ngFor="
                          let order of sample?.orders;
                          trackBy: order?.concept?.display;
                          let orderCount = index
                        "
                        [ngClass]="{ 'row-alternated': count % 2 !== 0 }"
                      >
                        <td
                          *ngIf="i == 0 && orderCount == 0"
                          [attr.rowspan]="sampleGroupedBymRNo?.rowSpan"
                        >
                          {{ count + 1 }}
                        </td>
                        <td
                          *ngIf="i == 0 && orderCount == 0"
                          [attr.rowspan]="sampleGroupedBymRNo?.rowSpan"
                        >
                          {{ sampleGroupedBymRNo?.mrNo }}
                        </td>
                        <td
                          *ngIf="i == 0 && orderCount == 0"
                          [attr.rowspan]="sampleGroupedBymRNo?.rowSpan"
                        >
                          {{ sample?.patientNames }}
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          {{ sample?.departmentName }}
                        </td>

                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          {{ sample?.sampleIdentifier }}
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          <span *ngIf="sample?.containerDetails?.display">
                            {{ sample?.containerDetails?.display }}
                          </span>
                          <span *ngIf="!sample?.containerDetails?.display">
                            N/A
                          </span>
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          {{ sample?.name }}
                        </td>
                        <td>
                          {{ order?.concept?.display }}
                        </td>
                        <td>{{ order?.orderer_names }}</td>
                        <td>
                          {{ order?.order_date | date: "medium" }}
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          <span *ngIf="sample.priorityHigh" class="text-danger">
                            High
                          </span>
                          <span *ngIf="!sample.priorityHigh"> Normal </span>
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          {{ sample?.collectedBy?.name }}
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          <button
                            [disabled]="
                              sample.accepted ||
                              sample.rejected ||
                              savedData[
                                sample.sampleUniquIdentification + '-sample'
                              ]
                            "
                            mat-button
                            (click)="
                              accept($event, sample, params?.providerDetails)
                            "
                          >
                            <mat-spinner
                              *ngIf="
                                params?.settingLabSampleStatus &&
                                savingMessage[sample.id + '-accept']
                              "
                              color="primary"
                              [diameter]="20"
                              style="
                                display: inline-block !important;
                                margin-right: 4px;
                              "
                            >
                            </mat-spinner>
                            Accept
                          </button>

                          <button
                            [disabled]="
                              sample.accepted ||
                              sample.rejected ||
                              savedData[
                                sample.sampleUniquIdentification + '-sample'
                              ]
                            "
                            mat-button
                            (click)="
                              reject($event, sample, params?.providerDetails)
                            "
                          >
                            <mat-spinner
                              *ngIf="
                                params?.settingLabSampleStatus &&
                                savingMessage[sample.id + '-reject']
                              "
                              color="primary"
                              [diameter]="20"
                              style="
                                display: inline-block !important;
                                margin-right: 4px;
                              "
                            >
                            </mat-spinner>
                            Reject
                          </button>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                </ng-container>
                <ng-container
                  *ngIf="
                    params?.samplesGroupedBymRNo &&
                    params?.samplesGroupedBymRNo?.length == 0
                  "
                >
                  <tr>
                    <td colspan="13" class="text-center text-danger">
                      <p>No available sample</p>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
        </mat-tab>

        <mat-tab label="Worklist">
          <!-- {{params?.technicianWorklist | json}} -->
          <div style="padding: 15px 2px">
            <!-- <div class="legend" style="float: right">
                  <span class="rejected"></span><span>Rejected</span>
                </div> -->
            <div>
              <mat-form-field class="w-50">
                <mat-label>Search</mat-label>
                <mat-icon matPrefix>search</mat-icon
                ><input
                  matInput
                  (keyup)="onSearch($event)"
                  [(ngModel)]="searchingText"
                />
              </mat-form-field>

              <mat-form-field appearance="fill" class="w-30 ml-2 float-right">
                <mat-label>Select Department</mat-label>
                <mat-select [(value)]="selectedDepartment">
                  <mat-option (click)="setDepartment('')"
                    >All Departments</mat-option
                  >
                  <mat-option
                    *ngFor="let dept of labDepartments"
                    [value]="dept.display"
                    (click)="setDepartment(dept.display)"
                  >
                    {{ dept.display }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <table class="table table-bordered">
              <thead>
                <tr class="table-header">
                  <th>SN</th>
                  <th>MRNo.</th>
                  <th>Department</th>
                  <th>Specimen</th>
                  <th>Sample ID</th>
                  <th>Test order</th>
                  <th>Order Date</th>
                  <th>Ordered by</th>
                  <th>Priority</th>
                  <th>Container</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <ng-container
                  *ngIf="
                    params?.technicianWorklist &&
                    params?.technicianWorklist?.length > 0
                  "
                >
                  <ng-template
                    ngFor
                    let-count="index"
                    let-testOrder
                    [ngForOf]="
                      params?.technicianWorklist
                        | filterSamples: searchingText:selectedDepartment
                    "
                  >
                    <tr [ngClass]="{ 'row-alternated': count % 2 !== 0 }">
                      <td>
                        <!-- {{testOrder | json}} -->
                        {{ count + 1 }}
                      </td>
                      <td>
                        {{ testOrder?.identifier }}
                      </td>
                      <td>
                        {{ testOrder?.departmentName }}
                      </td>
                      <td>
                        {{ testOrder?.specimenName }}
                      </td>
                      <td>
                        {{ testOrder?.sampleIdentifier }}
                      </td>
                      <td>
                        {{ testOrder?.concept?.display }}
                      </td>
                      <td>{{ testOrder?.order_date | date: "medium" }}</td>
                      <td>
                        {{ testOrder?.orderer?.name }}
                      </td>
                      <td>
                        <span
                          *ngIf="testOrder?.priorityHigh"
                          style="color: #ff1414"
                          >HIGH</span
                        >
                        <span *ngIf="!testOrder?.priorityHigh"> None </span>
                      </td>
                      <td>
                        <span *ngIf="testOrder?.containerDetails?.display">
                          {{ testOrder?.containerDetails?.display }}
                        </span>
                        <span *ngIf="!testOrder?.containerDetails?.display">
                          N/A
                        </span>
                        -
                        {{ testOrder?.order_number }}
                      </td>
                      <td>
                        <span
                          class="text-warning"
                          *ngIf="
                            testOrder?.allocations &&
                            testOrder?.allocations?.length > 0 &&
                            testOrder?.allocations[0]?.results?.length == 0
                          "
                          >Results not fed</span
                        >
                        <span
                          class="text-warning"
                          *ngIf="
                            testOrder?.allocations &&
                            testOrder?.allocations?.length > 0 &&
                            testOrder?.allocations[0]?.results?.length > 0 &&
                            !testOrder?.allocations[0]?.results.firstSignOff
                          "
                          >Waiting approval</span
                        >

                        <span
                          class="text-warning"
                          *ngIf="
                            testOrder?.allocations &&
                            testOrder?.allocations?.length > 0 &&
                            testOrder?.allocations[0]?.results?.length > 0 &&
                            testOrder?.allocations[0]?.results?.firstSignOff &&
                            !testOrder?.allocations[0]?.results?.secondSignOff
                          "
                          >Waiting Second approval</span
                        >

                        <span
                          class="text-success"
                          *ngIf="
                            testOrder?.allocations &&
                            testOrder?.allocations?.length > 0 &&
                            testOrder?.allocations[0]?.results?.length > 0 &&
                            testOrder?.allocations[0]?.results?.secondSignOff
                          "
                          >Full Approved</span
                        >
                      </td>
                      <!-- <td>
                      <span
                        class="text-success"
                      >
                        Full Completed
                      </span>
                    </td> -->
                    </tr>
                    <tr></tr>
                  </ng-template>
                </ng-container>
                <ng-container
                  *ngIf="
                    params?.technicianWorklist &&
                    params?.technicianWorklist?.length == 0
                  "
                >
                  <tr>
                    <td colspan="11" class="text-center text-danger">
                      <p>No available tests for your worklist</p>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
        </mat-tab>

        <mat-tab label="Results Entry & Approval y">
          <div style="padding: 15px 2px">
            <!-- <div class="legend" style="float: right">
                  <span class="rejected"></span><span>Rejected</span>
                </div> -->
            <div>
              <mat-form-field class="w-50">
                <mat-label>Search</mat-label>
                <mat-icon matPrefix>search</mat-icon
                ><input
                  matInput
                  (keyup)="onSearch($event)"
                  [(ngModel)]="searchingText"
                />
              </mat-form-field>

              <table
                style="border: none; margin-left: 15px"
                class="w-20 float-right"
              >
                <tr style="height: 30px">
                  <td style="width: 40px; border: solid 1px #eee"></td>
                  <td>
                    <div style="margin-left: 3px; margin-right: 20px">
                      No results filled
                    </div>
                  </td>
                  <td
                    style="
                      background-color: #ec864acf;
                      width: 40px;
                      margin-left: 20px;
                    "
                  ></td>
                  <td>
                    <div style="margin-left: 3px; margin-right: 20px">
                      Has results
                    </div>
                  </td>
                  <td
                    style="
                      width: 40px;
                      background-color: #83892c8f;
                      margin-left: 20x;
                    "
                  ></td>
                  <td>
                    <div style="margin-left: 3px; margin-right: 20px">
                      First approval
                    </div>
                  </td>
                  <td
                    style="
                      background-color: #f5f171f7;
                      width: 40px;
                      margin-left: 20px;
                    "
                  ></td>
                  <td><div style="margin-left: 3px">Second approval</div></td>
                </tr>
              </table>
              <mat-form-field appearance="fill" class="w-30 ml-2 float-right">
                <mat-label>Select Department</mat-label>
                <mat-select [(value)]="selectedDepartment">
                  <mat-option (click)="setDepartment('')"
                    >All Departments</mat-option
                  >
                  <mat-option
                    *ngFor="let dept of labDepartments"
                    [value]="dept.display"
                    (click)="setDepartment(dept.display)"
                  >
                    {{ dept.display }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <table class="table table-bordered">
              <thead class="table-header">
                <tr>
                  <th rowspan="2">SN</th>
                  <th rowspan="2">MRNo.</th>
                  <th rowspan="2">Patient</th>
                  <th rowspan="2">Department</th>
                  <th rowspan="2">Sample/Specimen</th>
                  <th rowspan="2">Sample ID</th>
                  <th rowspan="2">Container</th>
                  <th colspan="3" class="text-center">Test Details</th>
                  <th rowspan="2">Priority</th>
                  <th rowspan="2">Accepted By</th>
                  <th rowspan="2">Actions</th>
                </tr>
                <tr>
                  <th>Test</th>
                  <th>Ordered By</th>
                  <th>Order Date</th>
                </tr>
              </thead>
              <tbody>
                <!-- <ng-template
                  ngFor
                  let-count="index"
                  let-sample
                  [ngForOf]="
                    params?.samplesToFeedResults | filterSamples: searchingText
                  "
                > -->
                <ng-container
                  *ngIf="
                    params?.labSamplesWaitingToFeedResults &&
                    params?.labSamplesWaitingToFeedResults?.length > 0
                  "
                >
                  <ng-container
                    *ngFor="
                      let groupedSample of params?.labSamplesWaitingToFeedResults;
                      let count = index
                    "
                  >
                    <ng-container
                      *ngFor="
                        let sample of groupedSample?.samples;
                        let i = index
                      "
                    >
                      <tr
                        [ngStyle]="{
                          'background-color':
                            sample?.allOrdersHaveResults && !order?.firstSignOff
                              ? '#ec864acf'
                              : order?.firstSignOff && !order?.secondSignOff
                              ? '#83892c8f'
                              : order?.firstSignOff && order?.secondSignOff
                              ? '#f5f171f7'
                              : ''
                        }"
                        *ngFor="
                          let order of sample?.orders;
                          let orderCount = index
                        "
                        [ngClass]="{ 'row-alternated': count % 2 !== 0 }"
                      >
                        <td
                          *ngIf="i == 0 && orderCount == 0"
                          [attr.rowspan]="groupedSample?.rowSpan"
                        >
                          <span>
                            {{ count + 1 }}
                          </span>
                        </td>
                        <td
                          *ngIf="i == 0 && orderCount == 0"
                          [attr.rowspan]="groupedSample?.rowSpan"
                        >
                          {{ sample?.mrNo }}
                        </td>
                        <td
                          *ngIf="i == 0 && orderCount == 0"
                          [attr.rowspan]="groupedSample?.rowSpan"
                        >
                          {{ sample?.patientNames }}
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          {{ sample?.departmentName }}
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          {{ sample.name }}
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          {{ sample.sampleIdentifier }}
                        </td>

                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          <span *ngIf="sample?.containerDetails?.display">
                            {{ sample?.containerDetails?.display }}
                          </span>
                          <span *ngIf="!sample?.containerDetails?.display">
                            N/A
                          </span>
                        </td>
                        <td
                          [ngStyle]="{
                            'background-color': order?.hasValue
                              ? '#ec864acf'
                              : ''
                          }"
                        >
                          {{ order?.concept?.display }}
                        </td>
                        <td
                          [ngStyle]="{
                            'background-color': order?.hasValue
                              ? '#ec864acf'
                              : ''
                          }"
                        >
                          {{ order?.orderer_names }}
                        </td>
                        <td
                          [ngStyle]="{
                            'background-color': order?.hasValue
                              ? '#ec864acf'
                              : ''
                          }"
                        >
                          {{ order?.order_date | date: "medium" }}
                        </td>
                        <td
                          [ngStyle]="{
                            'background-color': order?.hasValue
                              ? '#ec864acf'
                              : ''
                          }"
                        >
                          <span *ngIf="sample.hiPriority" style="color: #ff1414"
                            >High</span
                          >
                          <span *ngIf="!sample.hiPriority"> Normal </span>
                        </td>
                        <td
                          [ngStyle]="{
                            'background-color': order?.hasValue
                              ? '#ec864acf'
                              : ''
                          }"
                        >
                          {{ sample?.acceptedBy?.name }}
                        </td>
                        <td
                          *ngIf="orderCount == 0"
                          [attr.rowspan]="sample?.orders?.length"
                        >
                          <button
                            class="ml-2"
                            mat-stroked-button
                            (click)="
                              onOpenModalForFeedingResults($event, sample)
                            "
                          >
                            Results
                          </button>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                </ng-container>
                <ng-container
                  *ngIf="
                    params?.labSamplesWaitingToFeedResults &&
                    params?.labSamplesWaitingToFeedResults?.length == 0
                  "
                >
                  <tr>
                    <td colspan="13" class="text-center text-danger">
                      <p>No available samples</p>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
        </mat-tab>

        <mat-tab label="Sample tracking">
          <div style="padding: 15px 2px">
            <!-- <div class="legend" style="float: right">
                  <span class="rejected"></span><span>Rejected</span>
                </div> -->
            <div>
              <mat-form-field class="w-50">
                <mat-label>Search</mat-label>
                <mat-icon matPrefix>search</mat-icon
                ><input
                  matInput
                  (keyup)="onSearch($event)"
                  [(ngModel)]="searchingText"
                />
              </mat-form-field>

              <mat-form-field appearance="fill" class="w-30 ml-2 float-right">
                <mat-label>Select Department</mat-label>
                <mat-select [(value)]="selectedDepartment">
                  <mat-option (click)="setDepartment('')"
                    >All Departments</mat-option
                  >
                  <mat-option
                    *ngFor="let dept of labDepartments"
                    [value]="dept.display"
                    (click)="setDepartment(dept.display)"
                  >
                    {{ dept.display }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <table class="table table-bordered">
              <thead>
                <tr class="table-header">
                  <th>SN</th>
                  <th>MRNo.</th>
                  <th>Patient</th>
                  <th>Sample/Specimen</th>
                  <th>Sample ID</th>
                  <th>Department</th>
                  <th>Container</th>
                  <th>Collected by</th>
                  <th>Priority</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- <ng-template
                  ngFor
                  let-count="index"
                  let-sample
                  [ngForOf]="samplesToTrack | filterSamples: searchingText"
                > -->
                <ng-container
                  *ngIf="
                    params?.labSamplesForTrackingDetails &&
                    params?.labSamplesForTrackingDetails?.length > 0
                  "
                >
                  <ng-container
                    *ngFor="
                      let groupedSamples of params?.labSamplesForTrackingDetails;
                      let count = index
                    "
                  >
                    <tr
                      [ngClass]="{ 'row-alternated': count % 2 !== 0 }"
                      *ngFor="
                        let sample of groupedSamples?.samples;
                        let i = index
                      "
                    >
                      <td
                        *ngIf="i == 0"
                        [attr.rowspan]="groupedSamples?.samples?.length"
                      >
                        {{ count + 1 }}
                      </td>

                      <td
                        *ngIf="i == 0"
                        [attr.rowspan]="groupedSamples?.samples?.length"
                      >
                        {{ sample?.mrNo }}
                      </td>
                      <td
                        *ngIf="i == 0"
                        [attr.rowspan]="groupedSamples?.samples?.length"
                      >
                        {{ sample?.patientNames }}
                      </td>
                      <td>{{ sample?.name }}</td>
                      <td>{{ sample?.sampleIdentifier }}</td>
                      <td>{{ sample?.departmentName }}</td>
                      <td>
                        <span *ngIf="sample?.containerDetails?.display">
                          {{ sample?.containerDetails?.display }}
                        </span>
                        <span *ngIf="!sample?.containerDetails?.display">
                          N/A
                        </span>
                      </td>
                      <td>
                        {{ sample?.collectedBy?.name }}
                      </td>
                      <td>
                        <span *ngIf="sample.hiPriority" style="color: #ff1414">
                          HIGH
                        </span>
                        <span *ngIf="!sample.hiPriority"> None </span>
                      </td>
                      <td>
                        <span
                          class="text-success"
                          *ngIf="!sample.rejected && sample.accepted"
                          >Accepted</span
                        ><span class="text-danger" *ngIf="sample.rejected"
                          >Rejected</span
                        >
                        <!-- <div
                        *ngIf="
                          sample?.acceptRejectProviders &&
                          sample?.acceptRejectProviders?.length > 0
                        "
                      >
                        by
                        <ul>
                          <li
                            *ngFor="
                              let provider of sample?.acceptRejectProviders
                            "
                          >
                            {{ provider?.provider?.display }}
                          </li>
                        </ul>
                      </div> -->
                        <span
                          class="text-warning"
                          *ngIf="!sample['accepted'] && !sample['rejected']"
                        >
                          Waiting acceptance/rejection..
                        </span>
                      </td>
                      <td>
                        <button
                          class="ml-2"
                          [disabled]="sample.rejected || !sample?.accepted"
                          mat-stroked-button
                          (click)="setViewItems($event, sample)"
                        >
                          View
                        </button>
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
                <ng-container
                  *ngIf="
                    params?.labSamplesForTrackingDetails &&
                    params?.labSamplesForTrackingDetails?.length == 0
                  "
                >
                  <tr>
                    <td colspan="11" class="text-center text-danger">
                      <p>No available samples</p>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
        </mat-tab>

        <mat-tab label="Completed samples">
          <div style="padding: 15px 2px">
            <!-- <div class="legend" style="float: right">
                  <span class="rejected"></span><span>Rejected</span>
                </div> -->
            <div>
              <mat-form-field class="w-50">
                <mat-label>Search</mat-label>
                <mat-icon matPrefix>search</mat-icon
                ><input
                  matInput
                  (keyup)="onSearch($event)"
                  [(ngModel)]="searchingText"
                />
              </mat-form-field>

              <mat-form-field appearance="fill" class="w-30 ml-2 float-right">
                <mat-label>Select Department</mat-label>
                <mat-select [(value)]="selectedDepartment">
                  <mat-option (click)="setDepartment('')"
                    >All Departments</mat-option
                  >
                  <mat-option
                    *ngFor="let dept of labDepartments"
                    [value]="dept.display"
                    (click)="setDepartment(dept.display)"
                  >
                    {{ dept.display }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <table class="table table-bordered">
              <thead>
                <tr class="table-header">
                  <th>SN</th>
                  <th>Sample/Specimen</th>
                  <th>Sample ID</th>
                  <th>Department</th>
                  <th>Collected by</th>
                  <th>MRNo.</th>
                  <th>Patient</th>
                  <th>Priority</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- <ng-template
                  ngFor
                  let-count="index"
                  let-sample
                  [ngForOf]="
                    params?.samplesFullCompleted | filterSamples: searchingText
                  "
                > -->
                <ng-container
                  *ngIf="
                    params?.samplesFullCompleted &&
                    params?.samplesFullCompleted?.length > 0
                  "
                >
                  <ng-container
                    *ngFor="
                      let sample of params?.samplesFullCompleted;
                      let count = index
                    "
                  >
                    <tr [ngClass]="{ 'row-alternated': count % 2 !== 0 }">
                      <td>
                        <span>
                          {{ count + 1 }}
                        </span>
                      </td>
                      <td>{{ sample.name }}</td>
                      <td>{{ sample.sampleIdentifier }}</td>
                      <td>{{ sample?.departmentName }}</td>
                      <td>
                        {{ sample?.collectedBy?.name }}
                      </td>
                      <td>
                        {{ sample.mrNo }}
                      </td>
                      <td>
                        {{ sample.patientNames }}
                      </td>
                      <td>
                        <span *ngIf="sample.hiPriority"> HIGH </span>
                        <span *ngIf="!sample.hiPriority"> None </span>
                      </td>
                      <td>
                        <span *ngIf="sample.accepted" class="text-success"
                          >Completed</span
                        >
                      </td>
                      <td>
                        <button
                          mat-stroked-button
                          class="ml-2"
                          (click)="onOpenModalForFeedingResults($event, sample)"
                        >
                          View
                        </button>
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
                <ng-container
                  *ngIf="
                    params?.samplesFullCompleted &&
                    params?.samplesFullCompleted?.length == 0
                  "
                >
                  <tr>
                    <td colspan="10" class="text-center text-danger">
                      <p>No completed samples</p>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
        </mat-tab>

        <mat-tab label="Results">
          <div
            *ngIf="
              params?.samplesFullCompleted &&
              params?.samplesFullCompleted?.length > 0
            "
          >
            <!-- {{ params?.completedResultsGroupedByMRN | json }} -->
            <app-results-to-print
              [authenticatedUser]="providerDetails"
              [samplesFullCompleted]="params?.samplesFullCompleted"
              [labConfigs]="labConfigs"
              [visitsParams]="visitsParameters"
            ></app-results-to-print>
          </div>
          <div
            *ngIf="
              params?.samplesFullCompleted &&
              params?.samplesFullCompleted?.length == 0
            "
            class="text-center text-danger p-5"
          >
            <p>No completed results available</p>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
    <div *ngIf="!params?.samplesLoadedState || !params?.samplesFullCompleted">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
  </mat-card>
</div>
